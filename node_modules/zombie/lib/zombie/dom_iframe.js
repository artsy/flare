// Generated by CoffeeScript 1.6.3
var HTML, createHistory, frameInit;

createHistory = require("./history");

HTML = require("jsdom").dom.level3.html;

frameInit = HTML.HTMLFrameElement._init;

HTML.HTMLFrameElement._init = function() {
  var contentWindow, create, frame, parentWindow;
  frameInit.call(this);
  frame = this;
  parentWindow = frame.ownerDocument.parentWindow;
  contentWindow = null;
  Object.defineProperties(frame, {
    contentWindow: {
      get: function() {
        return contentWindow || create();
      }
    },
    contentDocument: {
      get: function() {
        return (contentWindow || create()).document;
      }
    }
  });
  return create = function(url) {
    var focus, open;
    focus = function(active) {
      return contentWindow = active;
    };
    open = createHistory(parentWindow.browser, focus);
    contentWindow = open({
      name: frame.name,
      parent: parentWindow,
      url: url
    });
    return contentWindow;
  };
};

HTML.HTMLFrameElement.prototype.setAttribute = function(name, value) {
  return HTML.HTMLElement.prototype.setAttribute.call(this, name, value);
};

HTML.HTMLFrameElement.prototype._attrModified = function(name, value, oldValue) {
  var onload, url,
    _this = this;
  HTML.HTMLElement.prototype._attrModified.call(this, name, value, oldValue);
  if (name === "name") {
    return this.ownerDocument.parentWindow.__defineGetter__(value, function() {
      return _this.contentWindow;
    });
  } else if (name === "src" && value) {
    url = HTML.resourceLoader.resolve(this.ownerDocument, value);
    this.contentWindow.location = url;
    onload = function() {
      _this.contentWindow.removeEventListener("load", onload);
      onload = _this.ownerDocument.createEvent("HTMLEvents");
      onload.initEvent("load", true, false);
      return _this.dispatchEvent(onload);
    };
    return this.contentWindow.addEventListener("load", onload);
  }
};
